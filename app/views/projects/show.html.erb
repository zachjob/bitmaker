<h1><%= @project.title %></h1>



<% if @project.image.present? %>
  <%= image_tag @project.image %>
<% end %>

<h3>Category</h3>
<%= @project.category.name%>


<h3>Project Owner

</h3>

<h3>Amount Pledged:
  <%= @project.total_pledged_in_project %>
</h3>

<p><%= @project.description %></p>
<p>Goal: <%= number_to_currency(@project.goal) %></p>
<p>Raised: <%= number_to_currency(@project.earned) %></p>
<p>Fundraising starts: <%= @project.start_date.strftime("%A %b %d %Y") %></p>
<p>Deadline: <%= @project.end_date.strftime("%A %b %d %Y") %></p>
<time class="project-days-left">
  <%= icon('clock-o') %>
  <%= "#{time_ago_in_words(@project.end_date)} #{( @project.end_date > Time.now.utc ) ? 'remaining' : 'past deadline'}" %>
</time>
<p> <%= @project.check_if_user_already_pledged(current_user) %></p>
<%= form_for [@project, Pledge.new] do |f| %>
  <%= f.number_field :dollar_amount, value: @project.rewards.minimum(:dollar_amount), step: 0.01 %>
  <%= f.submit "Pledge" %>
<% end %>

<h2>Rewards</h2>
<% @project.rewards.each do |reward| %>
  <p><%= number_to_currency(reward.dollar_amount) %></p>
  <p><%= reward.description %></p>

  <p>
    <small>
      <%= link_to "Remove reward", project_reward_path(@project, reward), method: 'delete' %>
    </small>
  </p>
<% end %>

<%= link_to "Add new reward", new_project_reward_path(@project) %>

  <section class="project-comments">
    <h2>Comments</h2>
    <%= render 'comments/comment_form' %>
    <% if current_user && current_user.pledged_projects.include?(@project) || @project.user == current_user %>
        <%= render 'comments/show', project: @project, comment: @comment%>
      <% elsif current_user %>
        <p>Please back this project if you'd like to leave a comment.</p>
      <% else %>
        <p><%= link_to "Log in", user_sessions_path %> to leave a comment </p>
      <% end %>

  </section>




  <h2>Updates</h2>

  <% @project.updates.each do |update| %>

    <p>
      <%= update.title %>
    </p>

    <p>
      <%= update.description %>
    </p>

    <br>

    <% end %>
